<!--
 * @Description: 热搜组件
 * @Author: lihk
 * @Date: 2025-03-03 17:33:16
-->
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { get } from '../utils/request';

interface Post {
  id: number;
  title: string;
  body: string;
  author: string;
  avatar: string;
  date: string;
  likes: number;
  comments: number;
  tags: string[];
}

const posts = ref<Post[]>([]);
const loading = ref(true);
const error = ref<string | null>(null);

const fetchPosts = async () => {
  try {
    loading.value = true;
    // 使用封装的 axios 请求
    const data = await get<any[]>('https://jsonplaceholder.typicode.com/posts?_limit=10');
    
    // 转换数据，添加模拟的额外信息
    posts.value = data.map(post => ({
      id: post.id,
      title: post.title,
      body: post.body,
      author: `作者 ${post.id}`,
      avatar: `https://picsum.photos/id/${post.id + 10}/200`,
      date: `${new Date().getMonth() + 1}月${new Date().getDate()}日`,
      likes: Math.floor(Math.random() * 100),
      comments: Math.floor(Math.random() * 50),
      tags: ['前端', 'Vue', 'JavaScript'].slice(0, Math.floor(Math.random() * 3) + 1)
    }));
  } catch (err) {
    error.value = '获取数据失败';
    console.error(err);
  } finally {
    loading.value = false;
  }
};

// 标签页选项
const tabItems = [
  { key: 'recommend', label: '推荐' },
  { key: 'newest', label: '最新' },
  { key: 'hottest', label: '热门' }
];
const activeTab = ref('recommend');

onMounted(() => {
  fetchPosts();
});
</script>

<template>
  <div>
    <!-- 内容标签页 -->
    <a-tabs v-model:activeKey="activeTab" class="mb-4">
      <a-tab-pane v-for="item in tabItems" :key="item.key" :tab="item.label" />
    </a-tabs>
    
    <!-- 文章列表 -->
    <a-spin :spinning="loading">
      <div v-if="error" class="my-4">
        <a-alert :message="error" type="error" show-icon />
      </div>
      
      <div v-else>
        <a-list
          :data-source="posts"
          item-layout="vertical"
          size="large"
        >
          <template #renderItem="{ item }">
            <a-list-item :key="item.id">
              <template #extra v-if="item.id % 2 === 0">
                <img
                  width="272"
                  alt="cover"
                  :src="`https://picsum.photos/id/${item.id + 50}/400/300`"
                  class="rounded-lg object-cover h-32"
                />
              </template>
              
              <a-list-item-meta>
                <template #title>
                  <a class="text-xl font-bold hover:text-blue-500">{{ item.title }}</a>
                </template>
                <template #avatar>
                  <a-avatar :src="item.avatar" />
                </template>
                <template #description>
                  <div class="flex items-center text-sm text-gray-500">
                    <span>{{ item.author }}</span>
                    <span class="mx-1">·</span>
                    <span>{{ item.date }}</span>
                  </div>
                </template>
              </a-list-item-meta>
              
              <div class="text-gray-600 my-2 line-clamp-2">{{ item.body }}</div>
              
              <div class="flex items-center justify-between mt-2">
                <div class="flex space-x-2">
                  <a-tag v-for="tag in item.tags" :key="tag" color="blue">{{ tag }}</a-tag>
                </div>
                
                <div class="flex items-center space-x-4 text-gray-500">
                  <span class="flex items-center">
                    <svg viewBox="0 0 1024 1024" width="1em" height="1em" fill="currentColor" class="mr-1">
                      <path d="M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 0 0 471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0 1 42.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"></path>
                    </svg>
                    {{ item.likes }}
                  </span>
                  <span class="flex items-center">
                    <svg viewBox="0 0 1024 1024" width="1em" height="1em" fill="currentColor" class="mr-1">
                      <path d="M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"></path><path d="M894 345c-48.1-66-115.3-110.1-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119.5-428.7-83.1-528 90.8-14.7 25.8-23 53.9-25.7 83H83c-11.6 0-20.9 9.2-20.9 20.5 0 11.4 9.3 20.5 20.9 20.5h88.2c1.7 38.5 10.8 73.3 23.8 105-14.2 29.7-21.9 60.8-21.9 93.1 0 108.7 86.2 196.5 192 196.5 56.8 0 107.4-24 140.8-66.8 26.9 25.9 58.4 42.8 92.2 50.2l1.2.2c41 9.1 82.8 10.7 119.8 4.4 20.1-3.4 41.1-9.7 62.7-19.7 42.9-19.7 76.4-49 97.3-86.6 19.2-34.4 29.9-85.5 29.9-133.7 0-49.9-11.3-89.1-36.3-127.1zM629 600.7c-9.5 15.2-22.9 28.1-39.4 38.2-31.3 19.1-71 26.3-106.4 20.3-43.8-7.3-72.3-32.8-72.3-63.6 0-30.7 28.5-56.2 72.3-63.6 9-1.5 18.3-2.3 27.7-2.3 26.3 0 52.8 6.3 78.7 18.6 16.5 7.8 29.9 17.5 39.4 28.8 9.5 11.3 14.8 24.2 14.8 37.1 0 12.9-5.2 25.8-14.8 37.1zM448.9 284.5c9.5-11.3 22.9-20.9 39.4-28.8 31.3-14.8 71-19.1 106.4-11.5 43.8 9.1 72.3 34.5 72.3 65.4 0 12.9-5.2 25.8-14.8 37.1-9.5 11.3-22.9 20.9-39.4 28.8-31.3 14.8-71 19.1-106.4 11.5-43.8-9.1-72.3-34.5-72.3-65.4 0-12.9 5.2-25.8 14.8-37.1z"></path><path d="M866.7 792.7c-15.3 7.2-31.3 13.1-47.7 17.7-35.3 9.9-70.3 14.1-103.2 12.5-4.6-.2-9.2-.6-13.7-1-44.5-5.3-72-14.4-72-14.4v-.1c-44.1-15.5-69.2-47.4-77-81.7-.3-1.3-.6-2.7-.8-4-1.4-7.2-2.2-14.6-2.2-22.1 0-11.7 1.9-23.2 5.7-34.3 1.3-3.9 2.8-7.8 4.6-11.5 15.6-34.2 50.3-60.4 93.9-70.7 36.1-8.5 76.4-8.5 116.9-.1 38.3 8 73.1 22.4 99.1 40.9 25.9 18.5 40.2 39.9 40.2 62.4 0 22.4-14.3 43.9-40.2 62.4-9.3 6.7-19.5 12.7-30.5 18.2-3.1 1.5-6.3 3-9.5 4.4-10.8 4.8-22.2 9.1-34.1 12.7-23.5 7.2-47.7 11.1-71.9 11.1-45.9 0-85.5-10.3-113.2-29.5-27.3-18.9-40.2-42.1-40.2-67.4 0-25.3 12.9-48.6 40.2-67.4 19-13.2 42.7-22.8 69.5-28.4-15.6-5.8-30.2-13.8-43.7-24.3-36.9-28.4-57.1-69.5-57.1-115.8 0-46.2 20.2-87.3 57.1-115.8 36.9-28.4 85.9-44.1 137.9-44.1s101 15.7 137.9 44.1c36.9 28.4 57.1 69.5 57.1 115.8 0 46.2-20.2 87.3-57.1 115.8-13.5 10.4-28.1 18.4-43.7 24.3 26.7 5.6 50.4 15.3 69.5 28.4 27.3 18.9 40.2 42.1 40.2 67.4 0 25.3-12.9 48.6-40.2 67.4-27.8 19.2-67.3 29.5-113.2 29.5-24.1 0-48.4-3.9-71.9-11.1-11.9-3.6-23.3-7.9-34.1-12.7-3.2-1.4-6.4-2.9-9.5-4.4-11-5.5-21.2-11.5-30.5-18.2-25.9-18.5-40.2-39.9-40.2-62.4 0-22.4 14.3-43.9 40.2-62.4 26-18.5 60.9-32.9 99.1-40.9 40.5-8.5 80.8-8.4 116.9.1 43.6 10.3 78.3 36.5 93.9 70.7 1.7 3.7 3.2 7.6 4.6 11.5 3.8 11.1 5.7 22.6 5.7 34.3 0 7.5-.7 14.9-2.2 22.1-.2 1.3-.5 2.7-.8 4-7.8 34.3-32.9 66.2-77 81.7v.1s-27.5 9.1-72 14.4c-4.5.5-9.1.8-13.7 1-32.9 1.6-67.9-2.6-103.2-12.5-16.4-4.6-32.4-10.5-47.7-17.7-61.1-28.9-95.6-75.4-95.6-125.3 0-49.9 34.5-96.4 95.6-125.3 15.3-7.2 31.3-13.1 47.7-17.7 35.3-9.9 70.3-14.1 103.2-12.5 4.6.2 9.2.6 13.7 1 44.5 5.3 72 14.4 72 14.4v.1c44.1 15.5 69.2 47.4 77 81.7.3 1.3.6 2.7.8 4 1.4 7.2 2.2 14.6 2.2 22.1 0 11.7-1.9 23.2-5.7 34.3-1.3 3.9-2.8 7.8-4.6 11.5-15.6 34.2-50.3 60.4-93.9 70.7-36.1 8.5-76.4 8.5-116.9.1-38.3-8-73.1-22.4-99.1-40.9-25.9-18.5-40.2-39.9-40.2-62.4 0-22.4 14.3-43.9 40.2-62.4 9.3-6.7 19.5-12.7 30.5-18.2 3.1-1.5 6.3-3 9.5-4.4 10.8-4.8 22.2-9.1 34.1-12.7 23.5-7.2 47.7-11.1 71.9-11.1 45.9 0 85.5 10.3 113.2 29.5 27.3 18.9 40.2 42.1 40.2 67.4 0 25.3-12.9 48.6-40.2 67.4-19 13.2-42.7 22.8-69.5 28.4 15.6 5.8 30.2 13.8 43.7 24.3 36.9 28.4 57.1 69.5 57.1 115.8 0 46.2-20.2 87.3-57.1 115.8-36.9 28.4-85.9 44.1-137.9 44.1s-101-15.7-137.9-44.1c-36.9-28.4-57.1-69.5-57.1-115.8 0-46.2 20.2-87.3 57.1-115.8 13.5-10.4 28.1-18.4 43.7-24.3-26.7-5.6-50.4-15.3-69.5-28.4-27.3-18.9-40.2-42.1-40.2-67.4 0-25.3 12.9-48.6 40.2-67.4 27.8-19.2 67.3-29.5 113.2-29.5 24.1 0 48.4 3.9 71.9 11.1 11.9 3.6 23.3 7.9 34.1 12.7 3.2 1.4 6.4 2.9 9.5 4.4 11 5.5 21.2 11.5 30.5 18.2 25.9 18.5 40.2 39.9 40.2 62.4 0 22.4-14.3 43.9-40.2 62.4-26 18.5-60.9 32.9-99.1 40.9-40.5 8.5-80.8 8.4-116.9-.1-43.6-10.3-78.3-36.5-93.9-70.7-1.7-3.7-3.2-7.6-4.6-11.5-3.8-11.1-5.7-22.6-5.7-34.3 0-7.5.7-14.9 2.2-22.1.2-1.3.5-2.7.8-4 7.8-34.3 32.9-66.2 77-81.7v-.1s27.5-9.1 72-14.4c4.5-.5 9.1-.8 13.7-1 32.9-1.6 67.9 2.6 103.2 12.5 16.4 4.6 32.4 10.5 47.7 17.7 61.1 28.9 95.6 75.4 95.6 125.3 0 49.9-34.5 96.4-95.6 125.3z"></path>
                    </svg>
                    {{ item.comments }}
                  </span>
                </div>
              </div>
            </a-list-item>
          </template>
        </a-list>
      </div>
    </a-spin>
  </div>
</template>

<style scoped>
/* 文本截断 */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>